(()=>{class e extends Map{orderedValues(){return null!==this.orderedValuesCached?this.orderedValuesCached:Array.from(this.values()).sort(e.compareMarkers)}clear(){this.orderedValuesCached=null,super.clear()}delete(e){return this.orderedValuesCached=null,super.delete(e)}set(e,r){return this.orderedValuesCached=null,super.set(e,r)}add(e){return this.orderedValuesCached=null,super.set(e.id,e)}static compareMarkers(e,r){return e.time-r.time}constructor(...e){super(...e),this.orderedValuesCached=null}}let r=globalThis.videojs,t=r.getPlugin("plugin");class i extends t{static{this.VERSION="1.1.4"}static{this.DEFAULT_SETTINGS={markerStyle:{width:"0.5rem",borderRadius:"30%",backgroundColor:"red"},markerTip:{display:!0,innerHtml:e=>`Break: ${e.text}`}}}constructor(t,s){super(t),this.remainingMarkers=[],this.visitedMarkers=[],this.id=0,this.boundCheckIfMarkerReached=null,this.settings=r.obj.merge(i.DEFAULT_SETTINGS,s),this.markersMap=new e,this.settings.markerTip.display?(this.markerTip=r.dom.createEl("div",{className:"vjs-tip",innerHTML:'<div class="vjs-tip-arrow"></div><div class="vjs-tip-inner"></div>'}),this.player.$(".vjs-progress-holder")?.appendChild(this.markerTip)):this.markerTip=null,this.settings.onMarkerReached&&(this.boundCheckIfMarkerReached=this.checkIfMarkerReached.bind(this),this.player.on("timeupdate",this.boundCheckIfMarkerReached)),this.boundUpdateMarkers=this.updateMarkers.bind(this),this.player.on("durationchange",this.boundUpdateMarkers),this.boundDebouncedFindRemainingMarkers=r.fn.debounce(this.splitMarkers,500).bind(this),this.player.on("seeked",this.boundDebouncedFindRemainingMarkers)}getMarkers(){return this.markersMap.orderedValues()}next(){let e=this.remainingMarkers.pop();return void 0!==e&&(this.player.currentTime(e.time),this.visitedMarkers.push(e),!0)}prev(){let e=this.visitedMarkers.pop();return void 0!==e&&(this.player.currentTime(e.time),this.remainingMarkers.push(e),!0)}add(e){for(let r of e.map(e=>({...e,id:this.newId()})))this.markersMap.add(r),this.updateMarker(r);this.splitMarkers()}remove(e){for(let r of e){let e=this.player.$(`[data-marker-id='${r.id}']`);null!==e&&(e.onclick=null,e.onmouseover=null,e.onmouseout=null,e.remove()),this.markersMap.delete(r.id)}this.splitMarkers()}removeAll(){this.player.$$("[data-marker-id]").forEach(e=>{e.onclick=null,e.onmouseover=null,e.onmouseout=null,e.remove()}),this.markersMap.clear(),this.visitedMarkers.length=0,this.remainingMarkers.length=0}updateMarkers(){let e=this.player.duration();for(let r of this.markersMap.values())this.updateMarker(r,e);this.splitMarkers()}dispose(){this.removeAll(),this.settings.markerTip?.remove&&this.settings.markerTip.remove(),this.boundCheckIfMarkerReached&&this.player.off("timeupdate",this.boundCheckIfMarkerReached),this.player.off("durationchange",this.boundUpdateMarkers),this.player.off("seeked",this.boundDebouncedFindRemainingMarkers),super.dispose()}splitMarkers(){let e=this.markersMap.orderedValues(),r=i.binarySearch(e,this.player.currentTime());this.remainingMarkers=e.slice(r).reverse(),this.visitedMarkers=e.slice(0,r)}updateMarker(e,t){t=t??this.player.duration();let i=this.player.$(`[data-marker-id='${e.id}']`);i&&(i.onclick=null,i.onmouseover=null,i.onmouseout=null,i.remove());let s=r.dom.createEl("div",{},{class:`vjs-marker ${e.class??""}`,"data-marker-id":e.id,"data-marker-time":e.time});for(let e in this.settings.markerStyle)s.style[e]=this.settings.markerStyle[e];let a=e.time/t;s.style.display=a<0||a>1?"none":"block",s.style.left=e.time/t*100+"%",e.duration&&(s.style.width=e.duration/t*100+"%"),s.onmousedown=this.markerClicked.bind(this),s.onmouseover=this.showMarkerTip.bind(this),s.onmouseout=this.hideMarkerTip.bind(this),this.player.$(".vjs-progress-holder")?.appendChild(s)}markerClicked(e){e.stopPropagation(),e.preventDefault();let r=e.target.getAttribute("data-marker-id"),t=this.markersMap.get(r);this.player.currentTime(t.time),this.splitMarkers(),this.settings.onMarkerReached&&this.settings.onMarkerReached(t)}showMarkerTip(e){if(null===this.markerTip)return;let t=e.target,i=this.markersMap.get(t.getAttribute("data-marker-id"));this.markerTip.querySelector(".vjs-tip-inner").innerHTML=this.settings.markerTip.innerHtml(i),this.markerTip.style.left=i.time/this.player.duration()*100+"%";let s=r.dom.getBoundingClientRect(this.markerTip),a=r.dom.getBoundingClientRect(t);this.markerTip.style.marginLeft=a.width/4-s.width/2+"px",this.markerTip.style.visibility="visible"}hideMarkerTip(e){null!==this.markerTip&&(this.markerTip.style.visibility="hidden")}checkIfMarkerReached(){if(0===this.markersMap.size)return;let e=this.remainingMarkers[this.remainingMarkers.length-1];void 0!==e&&e.time-this.player.currentTime()<0&&(this.visitedMarkers.push(this.remainingMarkers.pop()),this.settings.onMarkerReached(e))}newId(){return(this.id++).toString()}static binarySearch(e,r){let t={from:0,to:e.length};for(;t.from!==t.to;){let i=t.from+t.to>>1;if(r>e[i].time)t.from=i+1;else{if(!(r<e[i].time))return i+1;t.to=i}}return t.to}}r.registerPlugin("markers",i)})();
//# sourceMappingURL=videojs-markers.js.map
